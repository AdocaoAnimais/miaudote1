CREATE TABLE IF NOT EXISTS ACOMPANHAMENTO_ADOCAO
(
    ACOMPANHAMENTO_ADOCAO_ID INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    DATA_ACOMPANHAMENTO      DATE    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DESCRICAO                VARCHAR(240),
    FOTO                     BLOB    NOT NULL,
    ADOCAO_ID                INTEGER NOT NULL,
    FOREIGN KEY (ADOCAO_ID) REFERENCES ADOCAO (ADOCAO_ID)
);
SELECT *
FROM ACOMPANHAMENTO_ADOCAO;
-- Primeira semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+7 days'), 'Descrição da primeira semana',
        'blob_da_foto', 1);

-- Segunda semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+14 days'), 'Descrição da segunda semana',
        'blob_da_foto', 1);

-- Terceira semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+21 days'), 'Descrição da terceira semana',
        'blob_da_foto', 1);

-- Quarta semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+28 days'), 'Descrição da quarta semana',
        'blob_da_foto', 1);

-- QUINTA semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+35 days'), 'Descrição da primeira semana',
        'blob_da_foto', 1);

-- SEXTA semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+43 days'), 'Descrição da segunda semana',
        'blob_da_foto', 1);

-- SETIMA semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+50 days'), 'Descrição da terceira semana',
        'blob_da_foto', 1);

-- OITAVA semana
INSERT INTO ACOMPANHAMENTO_ADOCAO (DATA_ACOMPANHAMENTO, DESCRICAO, FOTO, ADOCAO_ID)
VALUES (date((SELECT DATA_INICIO_ADOCAO FROM ADOCAO WHERE ADOCAO_ID = 1), '+58 days'), 'Descrição da quarta semana',
        'blob_da_foto', 1);

-- VERIFICA QUAIS ADOÇÕES JA COMPLETARAM O NUMERO MINIMO DE ACOMPANHAMENTOS E ONDE A DATA DE INICIO
-- DA ADOÇÃO FOI EM 90 DIAS ATRÁS

SELECT ADOCAO_ID
FROM ADOCAO
WHERE (
    SELECT COUNT(*)
    FROM ACOMPANHAMENTO_ADOCAO
    WHERE ADOCAO.ADOCAO_ID = ACOMPANHAMENTO_ADOCAO.ADOCAO_ID
        --  AND DATA_ACOMPANHAMENTO <= DATE('now')
) >= 3
AND DATA_INICIO_ADOCAO <= DATE('now', '-90 days');